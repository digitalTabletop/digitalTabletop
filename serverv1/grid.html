<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>GRID TEST</title>
    <style>
      body {
        overflow-x: auto;
      }
      table {
        display:block;
      }
      td{
        height: 1in;
        min-width: 1in;
        border: 1px solid Black;
        background-size: 1in 1in;
      }
      td[clicked=y]{
        background-color: red;
      }
      table {
        border-collapse: collapse;
        table-layout: fixed;
      }

    </style>
  </head>
  <body>
    <script type="text/javascript">
      var maxX = 13;
      var maxY = 20;

      var ws = new WebSocket("ws://10.0.25.102:8080");


      var body    = document.getElementsByTagName("body")[0];
      var tbl     = document.createElement("table");
      var tblBody = document.createElement("tbody");

      for ( y=0; y<maxY; y++) {
        var row = document.createElement("tr");
        for (var x = 0; x < maxX; x++) {
          var cell = document.createElement("td");
          cell.setAttribute("id", x+","+y);
          row.appendChild(cell);
        }
        tblBody.appendChild(row);
      }
      tbl.appendChild(tblBody);
      body.appendChild(tbl);
      tbl.addEventListener("click", function(e){
        var t = e.target;
        console.log(t.getAttribute("id"));
        payload = {};
        payload.x = t.getAttribute("id").split(",")[0];
        payload.y = t.getAttribute("id").split(",")[1];
        ws.send(JSON.stringify(payload));
      });
      ws.onmessage = function(event){
        var move = JSON.parse(event.data);
        var duplicateCells = document.querySelectorAll("[uid="+move.uid+"]");
        for (i=0; i<duplicateCells.length; i++) {
          duplicateCells[i].style = "background:none;"
          duplicateCells[i].setAttribute("uid", "")
        }
        // Javascript just has a shit DOM api
        var expected_id = move.x+","+move.y;
        console.log(expected_id);
        var location = document.getElementById(expected_id);
        location.setAttribute("uid", move.uid)
        if (move.color.split("(")[0] == "url") {
          location.style = "background:"+move.color+";background-size:1in 1in";
        }else{
          location.style = "background-color:"+move.color+";";
        }
      }
    </script>
  </body>
</html>
